<!DOCTYPE html>
<html>
<head>
    <title>Warehouse Inventory</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">

    <h1 class="mb-4">üè≠ Warehouse Inventory System</h1>

    <!-- ADD ITEM -->
    <div class="card p-4 mb-4 shadow">
        <h4>Add New Item</h4>
        <form action="/add" method="post" class="row g-3">
            <div class="col-md-4">
                <input type="text" name="sku" placeholder="SKU" class="form-control" required>
            </div>
            <div class="col-md-6">
                <input type="text" name="description" placeholder="Description" class="form-control" required>
            </div>
            <div class="col-md-2">
                <button class="btn btn-success w-100">Add Item</button>
            </div>
        </form>
    </div>

    <!-- INVENTORY TABLE -->
    <div class="card p-4 shadow">
        <h4 class="mb-3">Current Inventory</h4>

        <table class="table table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>SKU</th>
                    <th>Description</th>
                    <th>Total Qty</th>
                    <th>Bin Stock</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for row in inventory %}
                <tr>
                    <td>{{ row.item.id }}</td>
                    <td>{{ row.item.sku }}</td>
                    <td>{{ row.item.description }}</td>
                    <td>
                        <span class="badge bg-primary">
                            {{ row.total_quantity }}
                        </span>
                    </td>

                    <!-- BIN STOCK DISPLAY -->
                    <td>
                        {% for stock in row.stocks %}
                            <div>
                                Bin {{ stock.location_id }} :
                                <strong>{{ stock.quantity }}</strong>
                            </div>
                        {% else %}
                            <small class="text-muted">No stock yet</small>
                        {% endfor %}
                    </td>

                    <!-- ACTIONS -->
                    <td>

                        <!-- INBOUND -->
                        <form action="/inbound/{{ row.item.id }}" method="post" class="mb-2">
                            <div class="row g-1">
                                <div class="col">
                                    <select name="location_id" class="form-select" required>
                                        {% for loc in locations %}
                                            <option value="{{ loc.id }}">
                                                {{ loc.storage_type }} - {{ loc.bin_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col">
                                    <input type="number" name="quantity" placeholder="Qty" class="form-control" required>
                                </div>
                                <div class="col">
                                    <input type="text" name="partner" placeholder="Supplier" class="form-control" required>
                                </div>
                                <div class="col">
                                    <button class="btn btn-success btn-sm">IN</button>
                                </div>
                            </div>
                        </form>

                        <!-- OUTBOUND -->
                        <form action="/outbound/{{ row.item.id }}" method="post">
                            <div class="row g-1">
                                <div class="col">
                                    <select name="location_id" class="form-select" required>
                                        {% for loc in locations %}
                                            <option value="{{ loc.id }}">
                                                {{ loc.storage_type }} - {{ loc.bin_name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col">
                                    <input type="number" name="quantity" placeholder="Qty" class="form-control" required>
                                </div>
                                <div class="col">
                                    <input type="text" name="partner" placeholder="Customer" class="form-control" required>
                                </div>
                                <div class="col">
                                    <button class="btn btn-dark btn-sm">OUT</button>
                                </div>
                            </div>
                        </form>

                        <!-- MOVEMENT HISTORY -->
                        <div class="mt-3">
                            <strong>History:</strong>
                            <table class="table table-sm table-bordered mt-2">
                                <thead class="table-secondary">
                                    <tr>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Partner</th>
                                        <th>Qty</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for m in row.movements %}
                                    <tr>
                                        <td>{{ m.date }}</td>
                                        <td>
                                            {% if m.type == "INBOUND" %}
                                                <span class="badge bg-success">IN</span>
                                            {% else %}
                                                <span class="badge bg-dark">OUT</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ m.partner }}</td>
                                        <td>{{ m.quantity }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

    </div>

</div>

</body>
</html>
